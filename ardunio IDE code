#include <OneWire.h>
#include <DallasTemperature.h>
#include <SoftwareSerial.h>

// Pin Definitions
#define SOIL_MOISTURE A0
#define VOLTAGE_SENSOR A1
#define CURRENT_SENSOR A2
#define TEMP_PIN 2

#define WIFI_RX 9
#define WIFI_TX 10

OneWire oneWire(TEMP_PIN);
DallasTemperature sensors(&oneWire);
SoftwareSerial wifi(WIFI_RX, WIFI_TX);

void setup() {
  Serial.begin(9600);
  wifi.begin(9600);
  sensors.begin();
}

void loop() {
  int soil = analogRead(SOIL_MOISTURE);
  int voltage = analogRead(VOLTAGE_SENSOR);
  int current = analogRead(CURRENT_SENSOR);
  
  sensors.requestTemperatures();
  float temp = sensors.getTempCByIndex(0);

  Serial.println("Earthing Monitoring System:");
  Serial.print("Soil Moisture: "); Serial.println(soil);
  Serial.print("Voltage Level: "); Serial.println(voltage);
  Serial.print("Current Level: "); Serial.println(current);
  Serial.print("Temperature: "); Serial.print(temp); Serial.println(" °C");
  if (soil < 300) {
    Serial.println("⚠ ALERT: Soil moisture too low!");
  }

  if (voltage > 700) {
    Serial.println("⚠ ALERT: High voltage detected!");
  }

  if (current > 500) {
    Serial.println("⚠ ALERT: High current flow detected!");
  }

  if (temp > 50) {
    Serial.println("⚠ ALERT: High temperature detected!");
  }

  Serial.println("---------------------------\n");


  // You can add WiFi-based alert/processing logic here if needed

  delay(5000); // Delay between readings
}
